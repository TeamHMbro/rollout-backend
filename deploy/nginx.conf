user  nginx;
worker_processes  auto;

events {
    worker_connections  1024;
}

http {
    include       /etc/nginx/mime.types;
    default_type  application/octet-stream;

    sendfile        on;
    keepalive_timeout  65;

    upstream auth_service {
        server auth-service:8080;
    }

    upstream events_service {
        server events-service:8080;
    }

    upstream chat_service {
        server chat-service:8080;
    }

    upstream notifications_service {
        server notifications-service:8080;
    }

    server {
        listen 80;
        server_name _;

        client_max_body_size 10m;

        # Forward original request details to upstream services
        proxy_set_header   Host $host;
        proxy_set_header   X-Real-IP $remote_addr;
        proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header   X-Forwarded-Proto $scheme;
        proxy_set_header   Authorization $http_authorization;

        location /auth/swagger/ {
            proxy_pass         http://auth_service/swagger/;
            proxy_http_version 1.1;
        }

        location /auth {
            proxy_pass         http://auth_service;
            proxy_http_version 1.1;
        }

        location /events/swagger/ {
            proxy_pass         http://events_service/swagger/;
            proxy_http_version 1.1;
        }

        location /events {
            proxy_pass         http://events_service;
            proxy_http_version 1.1;
        }

        location /chat/swagger/ {
            proxy_pass         http://chat_service/swagger/;
            proxy_http_version 1.1;
        }

        location /chat {
            proxy_pass         http://chat_service;
            proxy_http_version 1.1;
        }

        location /notifications/swagger/ {
            proxy_pass         http://notifications_service/swagger/;
            proxy_http_version 1.1;
        }

        location /notifications {
            proxy_pass         http://notifications_service;
            proxy_http_version 1.1;
        }

        location = /healthz {
            add_header Content-Type text/plain;
            return 200 'OK';
        }
    }
}